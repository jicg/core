var e=Object.defineProperty,a=Object.prototype.hasOwnProperty,l=Object.getOwnPropertySymbols,t=Object.prototype.propertyIsEnumerable,o=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,r=(e,r)=>{for(var n in r||(r={}))a.call(r,n)&&o(e,n,r[n]);if(l)for(var n of l(r))t.call(r,n)&&o(e,n,r[n]);return e};import{s as n,a as i,b as s,c as d,e as p,f as u,g as m,u as c,h as b,i as g,d as f,p as y,j as h,r as k,k as N,o as w,l as D,m as v,n as P,q as S,F as _,t as C,v as I,x as q,y as O,w as j}from"./index.2317b1b9.js";import{g as V,_ as z,a as x}from"./ObjectPage.64234162.js";import G from"./JobPage.98a7597b.js";import"./vendor.25d1acb5.js";var U=f({props:{},setup:(e,a)=>r({},function(){let e=n({}),a=n({loading:!1,tableInfo:{}}),l=n({loading:!1,result:[],page:1,pageSize:30,orders:[],total:0,totalPage:0}),t=t=>{let o={};a.tableInfo.columns.forEach((a=>{let l=e[a.apiName];l&&("datenumber"==a.view_type?l.length>0&&(o[a.apiName]="BETWEEN "+i(l[0])+" AND "+i(l[1])):"date"==a.view_type?l.length>0&&(o[a.apiName]=[s(l[0]),s(l[1])]):o[a.apiName]=e[a.apiName])})),l.loading=!0,d.post("/sys/manager/api/"+a.tableInfo.name+"/list",{where:o,page:t,pageSize:l.pageSize,orders:l.orders}).then((e=>{l.result=e.data.datas,l.total=e.data.total,l.page=e.data.page,l.pageSize=e.data.pageSize,l.totalPage=e.data.totalPage,l.loading=!1})).catch((e=>{p(e),l.loading=!1}))},o=V();(()=>{const e=c();a.loading=!0,d.get("/sys/manager/api/table?name="+e.params.tableName).then((e=>{var o;a.tableInfo=e.data;try{l.orders=JSON.parse(null!=(o=a.tableInfo.defOrders)?o:"[]")}catch(r){p(r),console.log(r)}a.loading=!1,a.tableInfo.url||t(1)})).catch((e=>{p(e),a.loading=!1}))})();let f=u((()=>{var e,l;return null==(l=null==(e=a.tableInfo)?void 0:e.columns)?void 0:l.filter((e=>"Y"===e.isQuery))}));b();let y=u((()=>g()));return m(a,(a=>{a.tableInfo.columns.forEach((a=>{e[a.apiName]=""}))})),r({tableData:a,shortcuts:y,queryParam:e,queryCols:f,queryData:t,selectLabel:(e,a)=>{let l=a.selectOps.filter((a=>a.name==e));return l.length>0?l[0].remark:""},selectColor:(e,a)=>{let l=a.selectOps.filter((a=>a.name==e));return l.length>0?l[0].color:""},dataGrid:l,handleSortChange:(e,a,o)=>{l.orders=e.prop?[{field:e.prop,order:"ascending"==e.order?"asc":"desc"}]:[],t(l.page)},handleSelectionChange:e=>{console.log(e)},handleRowDbClick:(e,l,t)=>{o.openObjectDialog(a.tableInfo.remark,a.tableInfo.name,e.id)},findMutiObject:e=>{o.openDialog("查询-"+e.remark,"../../views/table/SearchPage.vue",{tableName:e.linkTable})},addMutiObject:e=>{o.openDialog("查询-"+e.remark,"../../views/table/SearchPage.vue",{tableName:e.linkTable})}},o)}()),name:"TablePage",components:{CustomDialog:z,JobPage:G,ObjectPage:x}});const Y=j();y("data-v-18a2c832");const E=q("查询");h();const M=Y(((e,a,l,t,o,r)=>{const n=k("el-option"),i=k("el-select"),s=k("el-date-picker"),d=k("el-input"),p=k("el-form-item"),u=k("el-button"),m=k("el-form"),c=k("el-card"),b=k("el-table-column"),g=k("el-tag"),f=k("el-icon"),y=k("el-table"),h=k("el-container"),j=k("el-pagination"),V=k("custom-dialog"),z=N("loading");return w(),D(_,null,[null!=e.tableData.tableInfo.name&&null!=e.tableData.tableInfo.url&&e.tableData.tableInfo.url.length>0&&e.tableData.tableInfo.url.indexOf("/")>=0?(w(),D("iframe",{key:0,style:{width:"100%",height:"calc(100% - 10px)",border:"none"},src:e.tableData.tableInfo.url},null,8,["src"])):null!=e.tableData.tableInfo.name&&null!=e.tableData.tableInfo.url&&e.tableData.tableInfo.url.length>0?(w(),D(v(e.tableData.tableInfo.url),{key:1})):P((w(),D(h,{key:2,style:{"flex-direction":"column"},"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading"},{default:Y((()=>[S(c,{shadow:"always",style:{margin:"10px"}},{default:Y((()=>[S(m,{size:"small",inline:!0,class:"demo-form-inline","label-width":"80px;"},{default:Y((()=>[(w(!0),D(_,null,C(e.queryCols,(l=>(w(),D(p,{label:l.remark},{default:Y((()=>["select"===l.view_type?(w(),D(i,{key:0,modelValue:e.queryParam[l.apiName],"onUpdate:modelValue":a=>e.queryParam[l.apiName]=a,placeholder:"请选择"},{default:Y((()=>[S(n,{label:"全部",value:""}),(w(!0),D(_,null,C(l.selectOps,(e=>(w(),D(n,{label:e.remark,value:e.name},null,8,["label","value"])))),256))])),_:2},1032,["modelValue","onUpdate:modelValue"])):"date"===l.view_type?(w(),D(s,{key:1,modelValue:e.queryParam[l.apiName],"onUpdate:modelValue":a=>e.queryParam[l.apiName]=a,type:"datetimerange","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",shortcuts:e.shortcuts,format:"YYYYMMDD HH:mm:ss"},null,8,["modelValue","onUpdate:modelValue","shortcuts"])):"datenumber"===l.view_type?(w(),D(s,{key:2,modelValue:e.queryParam[l.apiName],"onUpdate:modelValue":a=>e.queryParam[l.apiName]=a,type:"daterange",format:"YYYYMMDD","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",shortcuts:e.shortcuts},null,8,["modelValue","onUpdate:modelValue","shortcuts"])):(w(),D(d,{key:3,onKeyup:a[1]||(a[1]=I((a=>e.queryData(1)),["enter"])),modelValue:e.queryParam[l.apiName],"onUpdate:modelValue":a=>e.queryParam[l.apiName]=a,placeholder:"请输入查询内容"},null,8,["modelValue","onUpdate:modelValue"]))])),_:2},1032,["label"])))),256)),S(p,null,{default:Y((()=>[S(u,{type:"primary",onClick:a[2]||(a[2]=a=>e.queryData(1))},{default:Y((()=>[E])),_:1})])),_:1})])),_:1})])),_:1}),S(h,{style:{border:"1px solid #eee",margin:"10px"}},{default:Y((()=>[P(S(y,{size:"small",onSortChange:e.handleSortChange,onSelectionChange:e.handleSelectionChange,onRowDblclick:e.handleRowDbClick,data:e.dataGrid.result,height:480,border:""},{default:Y((()=>[(w(!0),D(_,null,C(e.tableData.tableInfo.columns,(a=>(w(),D(_,null,["id"===a.apiName?(w(),D(b,{key:0,sortable:"N"!==a.isSort,"show-overflow-tooltip":!0,width:"60",prop:a.apiName,label:a.remark},null,8,["sortable","prop","label"])):"select"===a.view_type?(w(),D(b,{key:1,sortable:"N"!==a.isSort,prop:a.apiName,label:a.remark,width:"120"},{default:Y((l=>[S(g,{size:"mini",style:{color:"white"},color:e.selectColor(l.row[a.apiName],a)},{default:Y((()=>[q(O(e.selectLabel(l.row[a.apiName],a)),1)])),_:2},1032,["color"])])),_:2},1032,["sortable","prop","label"])):"object"===a.view_type?(w(),D(b,{key:2,sortable:"N"!==a.isSort,prop:a.apiName,label:a.remark},{default:Y((l=>[S(f,{class:"el-icon-link",onClick:t=>e.openObjectDialog(a.linkTableName,a.linkTable,l.row[a.apiName])},null,8,["onClick"]),S("span",null,O(l.row[a.apiName+"_desc"]),1)])),_:2},1032,["sortable","prop","label"])):(w(),D(b,{key:3,sortable:"N"!==a.isSort,"show-overflow-tooltip":!0,prop:a.apiName,label:a.remark},{default:Y((e=>[q(O(e.row[a.apiName]),1)])),_:2},1032,["sortable","prop","label"]))],64)))),256))])),_:1},8,["onSortChange","onSelectionChange","onRowDblclick","data"]),[[z,e.dataGrid.loading]])])),_:1}),S(j,{onSizeChange:a[3]||(a[3]=a=>{e.dataGrid.pageSize=a,e.queryData(e.dataGrid.page)}),onCurrentChange:a[4]||(a[4]=a=>e.queryData(a)),currentPage:e.dataGrid.page,"onUpdate:currentPage":a[5]||(a[5]=a=>e.dataGrid.page=a),onPrevClick:a[6]||(a[6]=a=>e.queryData(e.dataGrid.page-1)),onNextClick:a[7]||(a[7]=a=>e.queryData(e.dataGrid.page+1)),"page-sizes":[10,30,50,100],"page-size":e.dataGrid.pageSize,layout:"sizes, prev, pager, next,total",total:e.dataGrid.total},null,8,["currentPage","page-size","total"])])),_:1},512)),[[z,e.tableData.loading]]),S(V,{ref:"dialogRef"},null,512)],64)}));U.render=M,U.__scopeId="data-v-18a2c832";export default U;

var H=Object.defineProperty;var G=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable;var $=(e,o,s)=>o in e?H(e,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[o]=s,B=(e,o)=>{for(var s in o||(o={}))K.call(o,s)&&$(e,s,o[s]);if(G)for(var s of G(o))Q.call(o,s)&&$(e,s,o[s]);return e};import{s as j,a as U,t as W,h as z,u as X,w as Z,i as x,d as ee,r as m,j as ae,o as p,k as D,c as f,O as te,G as le,E as oe,l as R,n as d,m as g,F as w,p as C,q,y as F,A as re,B as P}from"./vendor.257a1e03.js";import{d as J,a as L,s as T,b as ne}from"./comm.155bb935.js";import{e as ie,g as se,C as ue}from"./CustomDialog.34010575.js";import pe from"./SearchPage.0ec2074b.js";import de from"./JobPage.f142582e.js";import me from"./ObjectPage.9c5c37d7.js";import{_ as ge}from"./plugin-vue_export-helper.5a098b48.js";import"./index.8b621e0d.js";function fe(){let e=j({}),o=j({loading:!1,tableInfo:{}}),s=j({loading:!1,result:[],page:1,pageSize:30,orders:[],total:0,totalPage:0,selection:[]}),Y=()=>{const r=x();o.loading=!0,U.get("/sys/manager/api/table?name="+r.params.tableName).then(n=>{var l;o.tableInfo=n.data;try{s.orders=JSON.parse((l=o.tableInfo.defOrders)!=null?l:"[]")}catch(t){T(t),console.log(t)}o.tableInfo.columns.forEach(t=>{if(t.view_type==="datenumber"&&t.queryDefault){var y=parseInt(t.queryDefault)||7;const i=new Date;i.setTime(i.getTime()-3600*1e3*24*y),e[t.apiName]=[new Date(i.getFullYear(),i.getMonth(),i.getDate()),new Date(i.getFullYear(),i.getMonth(),i.getDate(),24)]}else if(t.view_type==="date"&&t.queryDefault){var y=parseInt(t.queryDefault)||1;const b=new Date;b.setTime(b.getTime()-3600*1e3*24*y),e[t.apiName]=[new Date(b.getFullYear(),b.getMonth(),b.getDate()),new Date(b.getFullYear(),b.getMonth(),b.getDate(),24)]}else t.view_type==="select"&&t.queryDefault||t.view_type==="check"&&t.queryDefault?e[t.apiName]=t.queryDefault:e[t.apiName]=""}),o.loading=!1,o.tableInfo.url||_(1)}).catch(n=>{T(n),o.loading=!1})},_=r=>{let n={};o.tableInfo.columns.forEach(l=>{let t=e[l.apiName];!t||(l.view_type=="datenumber"?t.length>0&&(n[l.apiName]="BETWEEN "+J(t[0])+" AND "+J(t[1])):l.view_type=="date"?t.length>0&&(n[l.apiName]=[L(t[0]),L(t[1])]):l.view_type=="object"?t.length>0&&(n[l.apiName]=e[l.apiName]):l.view_type=="select"||l.view_type=="check"?n[l.apiName]="= "+e[l.apiName]:n[l.apiName]=e[l.apiName])}),s.loading=!0,U.post("/sys/manager/api/"+o.tableInfo.name+"/list",{where:n,page:r,pageSize:s.pageSize,orders:s.orders}).then(l=>{s.result=l.data.datas,s.total=l.data.total,s.page=l.data.page,s.pageSize=l.data.pageSize,s.totalPage=l.data.totalPage,s.loading=!1}).catch(l=>{T(l),s.loading=!1})},O=(r,n,l)=>{s.orders=r.prop?[{field:r.prop,order:r.order=="ascending"?"asc":"desc"}]:[],_(s.page)},k=r=>{s.selection=W(r)},N=se(),v=(r,n,l)=>{N.openObjectDialog(o.tableInfo.remark,o.tableInfo.name,r.id)};Y();let c=z(()=>{var r,n;return(n=(r=o.tableInfo)==null?void 0:r.columns)==null?void 0:n.filter(l=>l.isQuery==="Y"&&l.isListCol!=="N")}),I=z(()=>{var r,n;return(n=(r=o.tableInfo)==null?void 0:r.columns)==null?void 0:n.filter(l=>l.isListCol!=="N")});X();let S=z(()=>ne()),E=(r,n)=>{let l=n.selectOps.filter(t=>t.name==r);return l.length>0?l[0].remark:""},V=(r,n)=>{let l=n.selectOps.filter(t=>t.name==r);return l.length>0?l[0].color:""},h=r=>{let n=N.openDialog("\u67E5\u8BE2-"+r.remark,pe,{tableName:r.linkTable},{closeDialog:function(l){e[r.apiName]=JSON.stringify(l),e[r.apiName+"_desc"]=l.desc,n.close()}})};return Z(o,r=>{var n,l;(l=(n=r.tableInfo)==null?void 0:n.columns)==null||l.forEach(t=>{if(t.view_type==="datenumber"&&t.queryDefault){const i=new Date;var y=parseInt(t.queryDefault)||7;i.setTime(i.getTime()-3600*1e3*24*y),e[t.apiName]=[new Date(i.getFullYear(),i.getMonth(),i.getDate()),new Date(i.getFullYear(),i.getMonth(),i.getDate(),24)]}else if(t.view_type==="date"&&t.queryDefault){const i=new Date;var y=parseInt(t.queryDefault)||1;i.setTime(i.getTime()-3600*1e3*24*y),e[t.apiName]=[new Date(i.getFullYear(),i.getMonth(),i.getDate()),new Date(i.getFullYear(),i.getMonth(),i.getDate(),24)]}else t.view_type==="select"&&t.queryDefault||t.view_type==="check"&&t.queryDefault?e[t.apiName]=t.queryDefault:e[t.apiName]=""})}),B({tableData:o,shortcuts:S,queryParam:e,queryCols:c,queryData:_,listCols:I,selectLabel:E,selectColor:V,dataGrid:s,handleSortChange:O,handleSelectionChange:k,handleRowDbClick:v,findMutiObject:h,execBtn:ie},N)}const be=ee({props:{},setup(e,o){return B({},fe())},name:"TablePage",components:{CustomDialog:ue,JobPage:de,ObjectPage:me}}),ye=["src"],he=["onClick"],De=q("\u67E5\u8BE2"),we=F("span",{style:{flex:"1"}},null,-1),Ne=F("span",{style:{flex:"1"}},null,-1);function _e(e,o,s,Y,_,O){const k=m("el-option"),N=m("el-select"),v=m("el-input"),c=m("el-date-picker"),I=m("el-form-item"),S=m("el-col"),E=m("el-row"),V=m("el-form"),h=m("el-container"),r=m("el-button"),n=m("el-card"),l=m("el-pagination"),t=m("el-table-column"),y=m("el-tag"),i=m("el-icon"),b=m("el-table"),A=m("custom-dialog"),M=ae("loading");return p(),D(w,null,[e.tableData.tableInfo.name!=null&&e.tableData.tableInfo.url!=null&&e.tableData.tableInfo.url.length>0&&e.tableData.tableInfo.url.indexOf("/")>=0?(p(),D("iframe",{key:0,style:{width:"100%",height:"calc(100% - 10px)",border:"none"},src:e.tableData.tableInfo.url},null,8,ye)):e.tableData.tableInfo.name!=null&&e.tableData.tableInfo.url!=null&&e.tableData.tableInfo.url.length>0?(p(),f(oe(e.tableData.tableInfo.url.split("$")[0]),te(le({key:1},{param:e.tableData.tableInfo.url.split("$")[1]})),null,16)):R((p(),f(h,{key:2,style:{"flex-direction":"column"},"element-loading-text":"\u62FC\u547D\u52A0\u8F7D\u4E2D","element-loading-spinner":"el-icon-loading"},{default:d(()=>[g(n,{shadow:"always",style:{margin:"10px"}},{default:d(()=>[g(h,{style:{"flex-direction":"row","padding-top":"6px"}},{default:d(()=>[g(V,{class:"custom-form",size:"mini","label-width":"80px"},{default:d(()=>[g(E,{gutter:0,style:{width:"100%"}},{default:d(()=>[(p(!0),D(w,null,C(e.queryCols,a=>(p(),f(S,{xs:24,sm:e.queryCols.length<=1?24:12,md:e.queryCols.length<=3?12:6},{default:d(()=>[g(I,{label:a.remark},{default:d(()=>[a.view_type==="select"?(p(),f(N,{key:0,class:"border-all",modelValue:e.queryParam[a.apiName],"onUpdate:modelValue":u=>e.queryParam[a.apiName]=u,placeholder:"\u8BF7\u9009\u62E9"},{default:d(()=>[g(k,{label:"\u5168\u90E8",value:""}),(p(!0),D(w,null,C(a.selectOps,u=>(p(),f(k,{label:u.remark,value:u.name},null,8,["label","value"]))),256))]),_:2},1032,["modelValue","onUpdate:modelValue"])):a.view_type==="object"?(p(),f(v,{key:1,class:"border-all",modelValue:e.queryParam[a.apiName+"_desc"],"onUpdate:modelValue":u=>e.queryParam[a.apiName+"_desc"]=u,placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9"},{suffix:d(()=>[F("i",{class:"el-icon-search",onClick:u=>e.findMutiObject(a,!0),style:{padding:"3px"}},null,8,he)]),_:2},1032,["modelValue","onUpdate:modelValue"])):a.view_type==="date"?(p(),f(c,{key:2,class:"border-all",style:{border:"1px solid #dcdfe6",width:"100%"},modelValue:e.queryParam[a.apiName],"onUpdate:modelValue":u=>e.queryParam[a.apiName]=u,type:"datetimerange","unlink-panels":"","range-separator":"\u81F3","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F",shortcuts:e.shortcuts,format:"YYYYMMDD HH:mm:ss"},null,8,["modelValue","onUpdate:modelValue","shortcuts"])):a.view_type==="datenumber"?(p(),f(c,{key:3,class:"border-all",style:{border:"1px solid #dcdfe6",width:"100%"},modelValue:e.queryParam[a.apiName],"onUpdate:modelValue":u=>e.queryParam[a.apiName]=u,type:"daterange",format:"YYYYMMDD","unlink-panels":"","range-separator":"\u81F3","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F",shortcuts:e.shortcuts},null,8,["modelValue","onUpdate:modelValue","shortcuts"])):(p(),f(v,{key:4,class:"border-all",onKeyup:o[0]||(o[0]=re(u=>e.queryData(1),["enter"])),modelValue:e.queryParam[a.apiName],"onUpdate:modelValue":u=>e.queryParam[a.apiName]=u,placeholder:"\u8BF7\u8F93\u5165\u67E5\u8BE2\u5185\u5BB9"},null,8,["modelValue","onUpdate:modelValue"]))]),_:2},1032,["label"])]),_:2},1032,["sm","md"]))),256))]),_:1})]),_:1})]),_:1}),g(h,{style:{height:"28px",border:"none",padding:"0px"}},{default:d(()=>[g(r,{type:"primary",onClick:o[1]||(o[1]=a=>e.queryData(1))},{default:d(()=>[De]),_:1}),we]),_:1})]),_:1}),g(h,{style:{border:"1px solid #eee",margin:"10px","flex-direction":"column"}},{default:d(()=>[g(h,{style:{height:"36px",border:"none",padding:"4px"}},{default:d(()=>[g(l,{class:"border-none",onSizeChange:o[2]||(o[2]=a=>{e.dataGrid.pageSize=a,e.queryData(e.dataGrid.page)}),onCurrentChange:o[3]||(o[3]=a=>e.queryData(a)),currentPage:e.dataGrid.page,"onUpdate:currentPage":o[4]||(o[4]=a=>e.dataGrid.page=a),onPrevClick:o[5]||(o[5]=a=>e.queryData(e.dataGrid.page-1)),onNextClick:o[6]||(o[6]=a=>e.queryData(e.dataGrid.page+1)),"page-sizes":[10,30,50,100],"page-size":e.dataGrid.pageSize,layout:"sizes, prev, pager, next,total",total:e.dataGrid.total},null,8,["currentPage","page-size","total"]),Ne,(p(!0),D(w,null,C(e.tableData.tableInfo.buttons,a=>(p(),f(r,{type:"primary",id:a.name,"data-btninfo":JSON.stringify(a),onClick:u=>e.execBtn(a,e.dataGrid.selection,()=>{e.queryData(1)})},{default:d(()=>[q(P(a.remark),1)]),_:2},1032,["id","data-btninfo","onClick"]))),256))]),_:1}),R(g(b,{size:"mini",onSortChange:e.handleSortChange,onSelectionChange:e.handleSelectionChange,onRowDblclick:e.handleRowDbClick,data:e.dataGrid.result,height:480,border:""},{default:d(()=>[g(t,{type:"selection",width:"55"}),(p(!0),D(w,null,C(e.listCols,a=>(p(),D(w,null,[a.apiName==="id"?(p(),f(t,{key:0,sortable:a.isSort!=="N","show-overflow-tooltip":!0,width:"60",prop:a.apiName,label:a.remark},null,8,["sortable","prop","label"])):a.view_type==="select"?(p(),f(t,{key:1,sortable:a.isSort!=="N","show-overflow-tooltip":!0,prop:a.apiName,label:a.remark,width:"120"},{default:d(u=>[g(y,{size:"mini",style:{color:"white"},color:e.selectColor(u.row[a.apiName],a)},{default:d(()=>[q(P(e.selectLabel(u.row[a.apiName],a)),1)]),_:2},1032,["color"])]),_:2},1032,["sortable","prop","label"])):a.view_type==="object"?(p(),f(t,{key:2,sortable:a.isSort!=="N","show-overflow-tooltip":!0,"min-width":a.list_size*30+40,prop:a.apiName,label:a.remark},{default:d(u=>[g(i,{class:"el-icon-link",onClick:ke=>e.openObjectDialog(a.linkTableName,a.linkTable,u.row[a.apiName])},null,8,["onClick"]),F("span",null,P(u.row[a.apiName+"_desc"]),1)]),_:2},1032,["sortable","min-width","prop","label"])):(p(),f(t,{key:3,sortable:a.isSort!=="N","show-overflow-tooltip":!0,prop:a.apiName,"min-width":a.list_size*30+40,label:a.remark},{default:d(u=>[q(P(u.row[a.apiName]),1)]),_:2},1032,["sortable","prop","min-width","label"]))],64))),256))]),_:1},8,["onSortChange","onSelectionChange","onRowDblclick","data"]),[[M,e.dataGrid.loading]])]),_:1})]),_:1},512)),[[M,e.tableData.loading]]),g(A,{ref:"dialogRef"},null,512)],64)}var Ve=ge(be,[["render",_e]]);export{Ve as default};

var Q=Object.defineProperty,W=Object.defineProperties;var X=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,x=Object.prototype.propertyIsEnumerable;var P=(e,n,l)=>n in e?Q(e,n,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[n]=l,z=(e,n)=>{for(var l in n||(n={}))Z.call(n,l)&&P(e,l,n[l]);if(O)for(var l of O(n))x.call(n,l)&&P(e,l,n[l]);return e},B=(e,n)=>W(e,X(n));import{g as ee,C as ae}from"./CustomDialog.34010575.js";import{i as $,s as V,a as T,h as I,w as E,d as q,r as d,j as Y,o as i,k as h,m as u,n as s,l as F,F as k,p as C,c as _,y as S,B as U,q as R,u as te,P as le}from"./vendor.257a1e03.js";import{s as G,e as oe,b as ne}from"./comm.155bb935.js";import{_ as M}from"./plugin-vue_export-helper.5a098b48.js";import"./index.8b621e0d.js";function ie(e,n){const l=$();let o=V({loading:!0,tableInfo:{},objectData:null}),f=V({value:null}),N=V({}),v=()=>{let b=e.tableName,c=l&&l.params.tableName;!b&&c&&(b=c),o.loading=!0,T.get("/sys/manager/api/table?name="+b).then(a=>{o.tableInfo=a.data,m()}).catch(a=>{G(a),o.loading=!1})},m=()=>{let b=e.id,c=l&&l.params.id;b==-1&&c&&(b=c),T.get("/sys/manager/api/"+o.tableInfo.name+"/get?id="+b).then(a=>{o.objectData=a.data,f.value=o.tableInfo.itemTables,o.loading=!1}).catch(a=>{G(a),o.loading=!1})};v();let y=I(()=>{var b,c;return(c=(b=o.tableInfo.columns)==null?void 0:b.filter(a=>a.name!=="id"))!=null?c:[]});E(o,b=>{var a,D;if(o.objectData==null)return;((D=(a=o.tableInfo.columns)==null?void 0:a.filter(r=>r.name!=="id"))!=null?D:[]).forEach(r=>{r.view_type==="select"?N[r.apiName]=""+o.objectData[r.apiName]:r.view_type==="datenumber"?N[r.apiName]=oe(""+o.objectData[r.apiName]):(r.view_type==="object"&&(N[r.apiName+"_desc"]=o.objectData[r.apiName+"_desc"]),N[r.apiName]=o.objectData[r.apiName])})});let p=(b,c)=>{let a=c.selectOps.filter(D=>D.name==b);return a.length>0?a[0].remark:""},w=I(()=>ne()),j=I(()=>f.value&&f.value.length>0?f.value:[]);return B(z({load:v,objectData:o,pageData:N,showColumns:y,selectLabel:p,shortcuts:w},ee()),{itemTables:j})}function re(e,n){$();let l=V({loading:!1,result:[],page:1,pageSize:30,orders:[],total:0,totalPage:0}),o=V({objectData:null,tableInfo:null});o.tableInfo=e.tableInfo,o.objectData=e.objectData;let f=m=>{if(o.objectData==null)return;let y={};y[o.tableInfo.upTableColumnName]="= "+o.objectData.id,l.loading=!0,T.post("/sys/manager/api/"+o.tableInfo.name+"/list",{where:y,page:m,pageSize:l.pageSize,orders:l.orders}).then(p=>{l.result=p.data.datas,l.total=p.data.total,l.page=p.data.page,l.pageSize=p.data.pageSize,l.totalPage=p.data.totalPage,l.loading=!1}).catch(p=>{G(p),l.loading=!1})},N=(m,y,p)=>{l.orders=m.prop?[{field:m.prop,order:m.order=="ascending"?"asc":"desc"}]:[],f(l.page)};E(e,()=>{f(1)});let v=I(()=>o.tableInfo?o.tableInfo.columns.filter(m=>m.name!=o.tableInfo.upTableColumnName):[]);return f(1),{handleSortChange:N,dataGrid:l,data:o,queryData:f,listColumns:v}}const se=q({props:{tableInfo:{type:Object,default:{}},objectData:{type:Object,default:{}}},emits:["openDialog"],setup(e,n){return z({openDialog:(o,f,N)=>{n.emit("openDialog",o,f,N)}},re(e))},name:"ItemGrid"});function de(e,n,l,o,f,N){const v=d("el-pagination"),m=d("el-table-column"),y=d("el-option"),p=d("el-select"),w=d("el-icon"),j=d("el-table"),b=d("el-container"),c=Y("loading");return i(),h(k,null,[u(v,{class:"border-none",onSizeChange:n[0]||(n[0]=a=>{e.dataGrid.pageSize=a,e.queryData(e.dataGrid.page)}),onCurrentChange:n[1]||(n[1]=a=>e.queryData(a)),currentPage:e.dataGrid.page,"onUpdate:currentPage":n[2]||(n[2]=a=>e.dataGrid.page=a),onPrevClick:n[3]||(n[3]=a=>e.queryData(e.dataGrid.page-1)),onNextClick:n[4]||(n[4]=a=>e.queryData(e.dataGrid.page+1)),"page-sizes":[10,30,50,100],"page-size":e.dataGrid.pageSize,layout:"sizes, prev, pager, next,total",total:e.dataGrid.total},null,8,["currentPage","page-size","total"]),u(b,null,{default:s(()=>[F(u(j,{class:"item-class",size:"mini",onSortChange:e.handleSortChange,data:e.dataGrid.result,height:420,border:""},{default:s(()=>[(i(!0),h(k,null,C(e.listColumns,a=>(i(),h(k,null,[a.apiName==="id"?(i(),_(m,{key:0,"show-overflow-tooltip":!0,sortable:a.isSort!=="N",width:"60",prop:a.apiName,label:a.remark},null,8,["sortable","prop","label"])):a.view_type==="select"?(i(),_(m,{key:1,"min-width":a.list_size*30+40,"show-overflow-tooltip":!0,sortable:a.isSort!=="N",prop:a.apiName,label:a.remark,width:"120"},{default:s(D=>[u(p,{size:"mini",disabled:"",modelValue:D.row[a.apiName],"onUpdate:modelValue":r=>D.row[a.apiName]=r,placeholder:"\u8BF7\u9009\u62E9"},{default:s(()=>[(i(!0),h(k,null,C(a.selectOps,r=>(i(),_(y,{label:r.remark,value:r.name},null,8,["label","value"]))),256))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["min-width","sortable","prop","label"])):a.view_type==="object"?(i(),_(m,{key:2,"min-width":a.list_size*30+40,"show-overflow-tooltip":!0,sortable:a.isSort!=="N",prop:a.apiName,label:a.remark},{default:s(D=>[u(w,{class:"el-icon-link",onClick:r=>e.openDialog(a.linkTableName,a.linkTable,D.row[a.apiName])},null,8,["onClick"]),S("span",null,U(D.row[a.apiName+"_desc"]),1)]),_:2},1032,["min-width","sortable","prop","label"])):(i(),_(m,{key:3,"min-width":a.list_size*30+40,sortable:a.isSort!=="N","show-overflow-tooltip":!0,prop:a.apiName,label:a.remark},{default:s(D=>[R(U(D.row[a.apiName]),1)]),_:2},1032,["min-width","sortable","prop","label"]))],64))),256))]),_:1},8,["onSortChange","data"]),[[c,e.dataGrid.loading]])]),_:1})],64)}var pe=M(se,[["render",de]]);const ue=q({components:{ItemGrid:pe,CustomDialog:ae},props:{id:{type:Number,default:-1},tableName:{type:String,default:""},editable:{type:Boolean,default:!1}},setup(e,n){let l=te();return $(),z({openNewPage:f=>{window.open(l.resolve(f).href,"_blank")}},ie(e))},name:"ObjectPage"}),me=R("\u5237\u65B0"),be={style:{"margin-top":"36px"}},ge=["onClick"],_e={key:1,class:"el-form-item__content el-input el-input--mini is-disabled interpreter-column"},fe=["onClick"];function ce(e,n,l,o,f,N){const v=d("el-button"),m=d("el-container"),y=d("el-input"),p=d("el-form-item"),w=d("el-date-picker"),j=d("el-option"),b=d("el-select"),c=d("el-col"),a=d("el-row"),D=d("el-form"),r=d("el-card"),L=d("item-grid"),H=d("el-tab-pane"),A=d("el-tabs"),J=d("custom-dialog"),K=Y("loading");return i(),h(k,null,[F(u(m,{class:"affix-container",style:{padding:"10px","flex-direction":"column"}},{default:s(()=>[u(m,{class:"fixedContainer",style:{height:"30px","padding-bottom":"6px"}},{default:s(()=>[u(v,{type:"primary",onClick:n[0]||(n[0]=t=>e.load())},{default:s(()=>[me]),_:1})]),_:1}),S("div",be,[u(r,null,{default:s(()=>[u(D,{class:"custom-form","label-width":"80px",size:"mini"},{default:s(()=>[u(a,{gutter:0,style:{width:"100%"}},{default:s(()=>[(i(!0),h(k,null,C(e.showColumns,t=>(i(),_(c,{xs:24*t.view_size,sm:12*t.view_size,md:6*t.view_size},{default:s(()=>[t.view_type==="textarea"?(i(),_(p,{key:0,label:t.remark},{default:s(()=>[u(y,{class:"border-all",type:"textarea",autosize:"",disabled:!e.editable,modelValue:e.pageData[t.apiName],"onUpdate:modelValue":g=>e.pageData[t.apiName]=g},null,8,["disabled","modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])):t.view_type==="date"?(i(),_(p,{key:1,label:t.remark},{default:s(()=>[u(w,{class:"border-all",disabled:!e.editable,style:{width:"100%"},modelValue:e.pageData[t.apiName],"onUpdate:modelValue":g=>e.pageData[t.apiName]=g,type:"date",placeholder:"\u9009\u62E9\u65E5\u671F",format:"YYYYMMDD HH:mm:ss",shortcuts:e.shortcuts},null,8,["disabled","modelValue","onUpdate:modelValue","shortcuts"])]),_:2},1032,["label"])):t.view_type==="datenumber"?(i(),_(p,{key:2,label:t.remark},{default:s(()=>[u(w,{class:"border-all",disabled:!e.editable,style:{width:"100%"},modelValue:e.pageData[t.apiName],"onUpdate:modelValue":g=>e.pageData[t.apiName]=g,type:"date",placeholder:"\u9009\u62E9\u65E5\u671F",format:"YYYYMMDD",shortcuts:e.shortcuts},null,8,["disabled","modelValue","onUpdate:modelValue","shortcuts"])]),_:2},1032,["label"])):t.view_type==="select"?(i(),_(p,{key:3,label:t.remark},{default:s(()=>[u(b,{class:"border-all",disabled:!e.editable,modelValue:e.pageData[t.apiName],"onUpdate:modelValue":g=>e.pageData[t.apiName]=g,placeholder:"\u8BF7\u9009\u62E9"},{default:s(()=>[(i(!0),h(k,null,C(t.selectOps,g=>(i(),_(j,{label:g.remark,value:g.name},null,8,["label","value"]))),256))]),_:2},1032,["disabled","modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])):t.view_type==="object"?(i(),_(p,{key:4,"data-info":e.pageData[t.apiName+"_desc"],label:t.remark},{default:s(()=>[e.editable?(i(),_(y,{key:0,class:"border-all",modelValue:e.pageData[t.apiName+"_desc"],"onUpdate:modelValue":g=>e.pageData[t.apiName+"_desc"]=g},{suffix:s(()=>[S("i",{class:"el-input__icon el-icon-link",onClick:g=>e.openObjectDialog(t.linkTableName,t.linkTable,e.pageData[t.apiName])},null,8,ge)]),_:2},1032,["modelValue","onUpdate:modelValue"])):(i(),h("div",_e,[S("a",{class:"text_nowrap custom-column border-all custom-link el-link el-link--primary isReadonly",size:"mini",onClick:g=>e.pageData[t.apiName]&&e.openObjectDialog(t.linkTableName,t.linkTable,e.pageData[t.apiName])},U(e.pageData[t.apiName]?e.pageData[t.apiName+"_desc"]:"\xA0"),9,fe)]))]),_:2},1032,["data-info","label"])):(i(),_(p,{key:5,label:t.remark},{default:s(()=>[u(y,{class:"border-all",disabled:!e.editable,modelValue:e.pageData[t.apiName],"onUpdate:modelValue":g=>e.pageData[t.apiName]=g},null,8,["disabled","modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))]),_:2},1032,["xs","sm","md"]))),256))]),_:1})]),_:1})]),_:1}),e.itemTables.length>0?(i(),_(A,{key:0,type:"border-card",style:{"margin-top":"10px"}},{default:s(()=>[(i(!0),h(k,null,C(e.itemTables,t=>(i(),_(H,{label:t.remark},{default:s(()=>[u(L,{onOpenDialog:e.openObjectDialog,"table-info":t,"object-data":e.objectData.objectData},null,8,["onOpenDialog","table-info","object-data"])]),_:2},1032,["label"]))),256))]),_:1})):le("",!0)])]),_:1},512),[[K,e.objectData.loading]]),u(J,{ref:"dialogRef"},null,512)],64)}var we=M(ue,[["render",ce],["__scopeId","data-v-d0538f52"]]);export{we as default};

var e=Object.defineProperty,a=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,o=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,r=(e,r)=>{for(var n in r||(r={}))l.call(r,n)&&o(e,n,r[n]);if(a)for(var n of a(r))t.call(r,n)&&o(e,n,r[n]);return e};import{s as n,e as i,y as s,v as d,x as p,u,a as m,f as c,r as b,h as g,o as f,c as y,C as h,w,G as k,i as N,F as D,j as _,z as C,k as v,t as x}from"./vendor.045e14f3.js";import{d as P,a as S,s as q,b as I}from"./index.65313445.js";import{e as j,g as O,_ as V}from"./CustomDialog.25bbff2f.js";import z from"./SearchPage.83a02783.js";import G from"./JobPage.aaedc5a2.js";import U from"./ObjectPage.578fb003.js";var Y=c({props:{},setup:(e,a)=>r({},function(){let e=n({}),a=n({loading:!1,tableInfo:{}}),l=n({loading:!1,result:[],page:1,pageSize:30,orders:[],total:0,totalPage:0,selection:[]}),t=t=>{let o={};a.tableInfo.columns.forEach((a=>{let l=e[a.apiName];l&&("datenumber"==a.view_type?l.length>0&&(o[a.apiName]="BETWEEN "+P(l[0])+" AND "+P(l[1])):"date"==a.view_type?l.length>0&&(o[a.apiName]=[S(l[0]),S(l[1])]):"object"==a.view_type?l.length>0&&(o[a.apiName]=e[a.apiName]):o[a.apiName]=e[a.apiName])})),l.loading=!0,i.post("/sys/manager/api/"+a.tableInfo.name+"/list",{where:o,page:t,pageSize:l.pageSize,orders:l.orders}).then((e=>{l.result=e.data.datas,l.total=e.data.total,l.page=e.data.page,l.pageSize=e.data.pageSize,l.totalPage=e.data.totalPage,l.loading=!1})).catch((e=>{q(e),l.loading=!1}))},o=O();(()=>{const e=u();a.loading=!0,i.get("/sys/manager/api/table?name="+e.params.tableName).then((e=>{var o;a.tableInfo=e.data;try{l.orders=JSON.parse(null!=(o=a.tableInfo.defOrders)?o:"[]")}catch(r){q(r),console.log(r)}a.loading=!1,a.tableInfo.url||t(1)})).catch((e=>{q(e),a.loading=!1}))})();let c=d((()=>{var e,l;return null==(l=null==(e=a.tableInfo)?void 0:e.columns)?void 0:l.filter((e=>"Y"===e.isQuery))}));m();let b=d((()=>I()));return p(a,(a=>{a.tableInfo.columns.forEach((a=>{e[a.apiName]=""}))})),r({tableData:a,shortcuts:b,queryParam:e,queryCols:c,queryData:t,selectLabel:(e,a)=>{let l=a.selectOps.filter((a=>a.name==e));return l.length>0?l[0].remark:""},selectColor:(e,a)=>{let l=a.selectOps.filter((a=>a.name==e));return l.length>0?l[0].color:""},dataGrid:l,handleSortChange:(e,a,o)=>{l.orders=e.prop?[{field:e.prop,order:"ascending"==e.order?"asc":"desc"}]:[],t(l.page)},handleSelectionChange:e=>{l.selection=s(e)},handleRowDbClick:(e,l,t)=>{o.openObjectDialog(a.tableInfo.remark,a.tableInfo.name,e.id)},findMutiObject:a=>{let l=o.openDialog("查询-"+a.remark,z,{tableName:a.linkTable},{closeDialog:function(t){e[a.apiName]=JSON.stringify(t),e[a.apiName+"_desc"]=t.desc,l.close()}})},execBtn:j},o)}()),name:"TablePage",components:{CustomDialog:V,JobPage:G,ObjectPage:U}});const E=v("查询"),M=N("span",{style:{flex:"1"}},null,-1),J=N("span",{style:{flex:"1"}},null,-1);Y.render=function(e,a,l,t,o,r){const n=b("el-option"),i=b("el-select"),s=b("el-input"),d=b("el-date-picker"),p=b("el-form-item"),u=b("el-col"),m=b("el-row"),c=b("el-form"),P=b("el-container"),S=b("el-button"),q=b("el-card"),I=b("el-pagination"),j=b("el-table-column"),O=b("el-tag"),V=b("el-icon"),z=b("el-table"),G=b("custom-dialog"),U=g("loading");return f(),y(D,null,[null!=e.tableData.tableInfo.name&&null!=e.tableData.tableInfo.url&&e.tableData.tableInfo.url.length>0&&e.tableData.tableInfo.url.indexOf("/")>=0?(f(),y("iframe",{key:0,style:{width:"100%",height:"calc(100% - 10px)",border:"none"},src:e.tableData.tableInfo.url},null,8,["src"])):null!=e.tableData.tableInfo.name&&null!=e.tableData.tableInfo.url&&e.tableData.tableInfo.url.length>0?(f(),y(h(e.tableData.tableInfo.url),{key:1})):w((f(),y(P,{key:2,style:{"flex-direction":"column"},"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading"},{default:k((()=>[N(q,{shadow:"always",style:{margin:"10px"}},{default:k((()=>[N(P,{style:{"flex-direction":"row","padding-top":"6px"}},{default:k((()=>[N(c,{class:"custom-form",size:"mini","label-width":"80px"},{default:k((()=>[N(m,{gutter:0,style:{width:"100%"}},{default:k((()=>[(f(!0),y(D,null,_(e.queryCols,(l=>(f(),y(u,{xs:24,sm:e.queryCols.length<=1?24:12,md:e.queryCols.length<=3?12:6},{default:k((()=>[N(p,{label:l.remark},{default:k((()=>["select"===l.view_type?(f(),y(i,{key:0,class:" border-all",modelValue:e.queryParam[l.apiName],"onUpdate:modelValue":a=>e.queryParam[l.apiName]=a,placeholder:"请选择"},{default:k((()=>[N(n,{label:"全部",value:""}),(f(!0),y(D,null,_(l.selectOps,(e=>(f(),y(n,{label:e.remark,value:e.name},null,8,["label","value"])))),256))])),_:2},1032,["modelValue","onUpdate:modelValue"])):"object"===l.view_type?(f(),y(s,{key:1,class:" border-all",modelValue:e.queryParam[l.apiName+"_desc"],"onUpdate:modelValue":a=>e.queryParam[l.apiName+"_desc"]=a,placeholder:"请输入内容"},{suffix:k((()=>[N("i",{class:"el-icon-search",onClick:a=>e.findMutiObject(l,!0),style:{padding:"3px"}},null,8,["onClick"])])),_:2},1032,["modelValue","onUpdate:modelValue"])):"date"===l.view_type?(f(),y(d,{key:2,class:" border-all",style:{border:"1px solid #dcdfe6",width:"100%"},modelValue:e.queryParam[l.apiName],"onUpdate:modelValue":a=>e.queryParam[l.apiName]=a,type:"datetimerange","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",shortcuts:e.shortcuts,format:"YYYYMMDD HH:mm:ss"},null,8,["modelValue","onUpdate:modelValue","shortcuts"])):"datenumber"===l.view_type?(f(),y(d,{key:3,class:" border-all",style:{border:"1px solid #dcdfe6",width:"100%"},modelValue:e.queryParam[l.apiName],"onUpdate:modelValue":a=>e.queryParam[l.apiName]=a,type:"daterange",format:"YYYYMMDD","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",shortcuts:e.shortcuts},null,8,["modelValue","onUpdate:modelValue","shortcuts"])):(f(),y(s,{key:4,class:" border-all",onKeyup:a[1]||(a[1]=C((a=>e.queryData(1)),["enter"])),modelValue:e.queryParam[l.apiName],"onUpdate:modelValue":a=>e.queryParam[l.apiName]=a,placeholder:"请输入查询内容"},null,8,["modelValue","onUpdate:modelValue"]))])),_:2},1032,["label"])])),_:2},1032,["sm","md"])))),256))])),_:1})])),_:1})])),_:1}),N(P,{style:{height:"28px",border:"none",padding:"0px"}},{default:k((()=>[N(S,{type:"primary",onClick:a[2]||(a[2]=a=>e.queryData(1))},{default:k((()=>[E])),_:1}),M])),_:1})])),_:1}),N(P,{style:{border:"1px solid #eee",margin:"10px","flex-direction":"column"}},{default:k((()=>[N(P,{style:{height:"36px",border:"none",padding:"4px"}},{default:k((()=>[N(I,{class:"border-none",onSizeChange:a[3]||(a[3]=a=>{e.dataGrid.pageSize=a,e.queryData(e.dataGrid.page)}),onCurrentChange:a[4]||(a[4]=a=>e.queryData(a)),currentPage:e.dataGrid.page,"onUpdate:currentPage":a[5]||(a[5]=a=>e.dataGrid.page=a),onPrevClick:a[6]||(a[6]=a=>e.queryData(e.dataGrid.page-1)),onNextClick:a[7]||(a[7]=a=>e.queryData(e.dataGrid.page+1)),"page-sizes":[10,30,50,100],"page-size":e.dataGrid.pageSize,layout:"sizes, prev, pager, next,total",total:e.dataGrid.total},null,8,["currentPage","page-size","total"]),J,(f(!0),y(D,null,_(e.tableData.tableInfo.buttons,(a=>(f(),y(S,{type:"primary",id:a.name,"data-btninfo":JSON.stringify(a),onClick:l=>e.execBtn(a,e.dataGrid.selection,(()=>{e.queryData(1)}))},{default:k((()=>[v(x(a.remark),1)])),_:2},1032,["id","data-btninfo","onClick"])))),256))])),_:1}),w(N(z,{size:"mini",onSortChange:e.handleSortChange,onSelectionChange:e.handleSelectionChange,onRowDblclick:e.handleRowDbClick,data:e.dataGrid.result,height:480,border:""},{default:k((()=>[N(j,{type:"selection",width:"55"}),(f(!0),y(D,null,_(e.tableData.tableInfo.columns,(a=>(f(),y(D,null,["id"===a.apiName?(f(),y(j,{key:0,sortable:"N"!==a.isSort,"show-overflow-tooltip":!0,width:"60",prop:a.apiName,label:a.remark},null,8,["sortable","prop","label"])):"select"===a.view_type?(f(),y(j,{key:1,sortable:"N"!==a.isSort,"show-overflow-tooltip":!0,prop:a.apiName,label:a.remark,width:"120"},{default:k((l=>[N(O,{size:"mini",style:{color:"white"},color:e.selectColor(l.row[a.apiName],a)},{default:k((()=>[v(x(e.selectLabel(l.row[a.apiName],a)),1)])),_:2},1032,["color"])])),_:2},1032,["sortable","prop","label"])):"object"===a.view_type?(f(),y(j,{key:2,sortable:"N"!==a.isSort,"show-overflow-tooltip":!0,"min-width":30*a.list_size+40,prop:a.apiName,label:a.remark},{default:k((l=>[N(V,{class:"el-icon-link",onClick:t=>e.openObjectDialog(a.linkTableName,a.linkTable,l.row[a.apiName])},null,8,["onClick"]),N("span",null,x(l.row[a.apiName+"_desc"]),1)])),_:2},1032,["sortable","min-width","prop","label"])):(f(),y(j,{key:3,sortable:"N"!==a.isSort,"show-overflow-tooltip":!0,prop:a.apiName,"min-width":30*a.list_size+40,label:a.remark},{default:k((e=>[v(x(e.row[a.apiName]),1)])),_:2},1032,["sortable","prop","min-width","label"]))],64)))),256))])),_:1},8,["onSortChange","onSelectionChange","onRowDblclick","data"]),[[U,e.dataGrid.loading]])])),_:1})])),_:1},512)),[[U,e.tableData.loading]]),N(G,{ref:"dialogRef"},null,512)],64)};export default Y;

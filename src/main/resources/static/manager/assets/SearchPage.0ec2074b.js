var ae=Object.defineProperty,te=Object.defineProperties;var le=Object.getOwnPropertyDescriptors;var J=Object.getOwnPropertySymbols;var oe=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable;var Q=(t,o,i)=>o in t?ae(t,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[o]=i,M=(t,o)=>{for(var i in o||(o={}))oe.call(o,i)&&Q(t,i,o[i]);if(J)for(var i of J(o))ne.call(o,i)&&Q(t,i,o[i]);return t},X=(t,o)=>te(t,le(o));import{s as I,a as L,h as Z,u as ie,w as re,t as x,i as se,d as de,r as u,j as ue,o as p,k as w,l as ee,m as r,n,F as N,p as V,q as y,v as pe,x as me,c as b,y as $,A as fe,B as k}from"./vendor.257a1e03.js";import{g as ge,C as be}from"./CustomDialog.34010575.js";import{d as P,a as j,s as H,b as ye}from"./comm.155bb935.js";import{_ as he}from"./plugin-vue_export-helper.5a098b48.js";import"./index.8b621e0d.js";function _e(t,o){let i=I({}),s=I({loading:!1,tableInfo:{}}),f=I({loading:!1,result:[],page:1,pageSize:10,orders:[],total:0,totalPage:0}),m=I([]),D=()=>{se(),s.loading=!0,L.get("/sys/manager/api/table?name="+t.tableName).then(l=>{s.tableInfo=l.data,s.loading=!1,s.tableInfo.url||v(1)}).catch(l=>{H(l),s.loading=!1})},v=l=>{let e={};s.tableInfo.columns.forEach(a=>{let d=i[a.apiName];!d||(a.view_type=="datenumber"?d.length>0&&(e[a.apiName]="BETWEEN "+P(d[0])+" AND "+P(d[1])):a.view_type=="date"?d.length>0&&(e[a.apiName]=[j(d[0]),j(d[1])]):a.view_type==="select"&&a.queryDefault||a.view_type==="check"&&a.queryDefault?i[a.apiName]=a.queryDefault:e[a.apiName]=i[a.apiName])}),f.loading=!0,L.post("/sys/manager/api/"+s.tableInfo.name+"/list",{where:e,page:l,pageSize:f.pageSize,orders:f.orders}).then(a=>{f.result=a.data.datas,f.total=a.data.total,f.page=a.data.page,f.pageSize=a.data.pageSize,f.totalPage=a.data.totalPage,f.loading=!1}).catch(a=>{H(a),f.loading=!1})},C=(l,e,a)=>{f.orders=l.prop?[{field:l.prop,order:l.order=="ascending"?"asc":"desc"}]:[],v(f.page)},q=l=>{console.log(l)},E=ge();D();let S=Z(()=>{var l,e;return(e=(l=s.tableInfo)==null?void 0:l.columns)==null?void 0:e.filter(a=>a.isQuery==="Y")});ie();let z=Z(()=>ye()),O=(l,e)=>{let a=e.selectOps.filter(d=>d.name==l);return a.length>0?a[0].remark:""},h=(l,e)=>{let a=e.selectOps.filter(d=>d.name==l);return a.length>0?a[0].color:""},_=l=>{let e=E.openDialog("\u67E5\u8BE2-"+l.remark,Fe,{tableName:l.linkTable},{closeDialog:function(a){i[l.apiName]=JSON.stringify(a),i[l.apiName+"_desc"]=a.desc,e.close()}})},A=l=>{},c=()=>{};re(s,l=>{l.tableInfo.columns.forEach(e=>{i[e.apiName]=""})});let B=(l,e,a)=>{x(m).filter(F=>F.id===l.id).pop()||m.push({id:l.id,sql:l.id,type:0,tag:l[s.tableInfo.showColumn+""]})},G=function(l){let e=m.filter(a=>a.id==l.id).pop();e&&m.splice(m.indexOf(e),1)},R=function(l){m.splice(0,m.length)},T=function(){let l={};s.tableInfo.columns.forEach(e=>{let a=i[e.apiName];!a||(e.view_type=="datenumber"?a.length>0&&(l[e.apiName]="BETWEEN "+P(a[0])+" AND "+P(a[1])):e.view_type=="date"?a.length>0&&(l[e.apiName]=[j(a[0]),j(a[1])]):l[e.apiName]=i[e.apiName])}),L.post("/sys/manager/api/"+s.tableInfo.name+"/sql",{where:l}).then(e=>{let a=m.filter(d=>d.id=="-1").pop();a&&m.splice(m.indexOf(a),1),m.push({id:"-1",tag:e.data.desc,sql:e.data.sql,type:1})}).catch(e=>{H(e)})},U=function(){f.result.forEach(l=>{x(m).filter(a=>a.id===l.id).pop()||m.push({id:l.id,sql:l.id,type:0,tag:l[s.tableInfo.showColumn+""]})})},Y=function(){let l=s.tableInfo.realTable||s.tableInfo.name,e=[],a=[],d=m.filter(g=>g.type==0);d.length>0&&(e.push(`select ${s.tableInfo.name}.id  
                from ${l} ${s.tableInfo.name}  
                where ${s.tableInfo.name}.id in (${d.map(g=>g.id).join(",")})`),a.push("\u5305\u542B("+d.map(g=>g.tag).join(",")+")"));let F=m.filter(g=>g.type==1);F.length>0&&F.forEach(g=>{e.push(g.sql),a.push(g.tag)});let K,W="";e.length>0&&(K=`in ( ${e.join(" union all ")})`,W=a.map(g=>`(${g})`).join(" \u6216\u8005 ")),o.emit("closeDialog",{desc:W,sql:K})};return X(M({tableData:s,shortcuts:z,queryParam:i,queryCols:S,queryData:v,selectLabel:O,selectColor:h,dataGrid:f,handleSortChange:C,handleSelectionChange:q,handleRowDbClick:B,handleOnload:c,findMutiObject:_,addMutiObject:A},E),{tags:m,addOk:Y,addAllRow:U,delTag:G,delAll:R,addAll:T})}const ce=de({props:{tableName:{type:String,required:!0},isSingle:{type:Boolean,default:!1}},emits:["closeDialog"],setup(t,o){return M({},_e(t,o))},components:{CustomDialog:be},name:"SearchPage"}),we=t=>(pe("data-v-b25314d6"),t=t(),me(),t),Ne=["onClick"],ve=y("\u67E5\u8BE2"),ke=we(()=>$("span",{style:{flex:"1"}},null,-1)),De=y("\u6DFB\u52A0\u5168\u90E8"),Ce=y("\u6DFB\u52A0\u5F53\u524D\u9875"),qe=y("\u786E\u5B9A"),Ee=y("\u91CD\u7F6E"),Se=["onClick"];function Be(t,o,i,s,f,m){const D=u("el-option"),v=u("el-select"),C=u("el-input"),q=u("el-date-picker"),E=u("el-form-item"),S=u("el-col"),z=u("el-row"),O=u("el-form"),h=u("el-button"),_=u("el-container"),A=u("el-card"),c=u("el-table-column"),B=u("el-tag"),G=u("el-icon"),R=u("el-table"),T=u("el-pagination"),U=u("el-scrollbar"),Y=u("custom-dialog"),l=ue("loading");return p(),w(N,null,[ee(r(_,{style:{"flex-direction":"column"},"element-loading-text":"\u62FC\u547D\u52A0\u8F7D\u4E2D","element-loading-spinner":"el-icon-loading"},{default:n(()=>[r(A,{shadow:"always",style:{margin:"10px"}},{default:n(()=>[r(O,{class:"custom-form","label-width":"80px",size:"mini"},{default:n(()=>[r(z,{gutter:10,style:{width:"100%"}},{default:n(()=>[(p(!0),w(N,null,V(t.queryCols,e=>(p(),b(S,{xs:24,sm:12,md:6},{default:n(()=>[r(E,{label:e.remark},{default:n(()=>[e.view_type==="select"?(p(),b(v,{key:0,class:"border-all",modelValue:t.queryParam[e.apiName],"onUpdate:modelValue":a=>t.queryParam[e.apiName]=a,placeholder:"\u8BF7\u9009\u62E9"},{default:n(()=>[r(D,{label:"\u5168\u90E8",value:""}),(p(!0),w(N,null,V(e.selectOps,a=>(p(),b(D,{label:a.remark,value:a.name},null,8,["label","value"]))),256))]),_:2},1032,["modelValue","onUpdate:modelValue"])):e.view_type==="object"?(p(),b(C,{key:1,class:"border-all",modelValue:t.queryParam[e.apiName+"_desc"],"onUpdate:modelValue":a=>t.queryParam[e.apiName+"_desc"]=a,placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9"},{suffix:n(()=>[$("i",{class:"el-icon-search",onClick:a=>t.findMutiObject(e,!0),style:{padding:"3px"}},null,8,Ne)]),_:2},1032,["modelValue","onUpdate:modelValue"])):e.view_type==="date"?(p(),b(q,{key:2,class:"border-all",style:{width:"100%",border:"1px solid #dcdfe6"},modelValue:t.queryParam[e.apiName],"onUpdate:modelValue":a=>t.queryParam[e.apiName]=a,type:"datetimerange","unlink-panels":"","range-separator":"\u81F3","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F",shortcuts:t.shortcuts,format:"YYYYMMDD HH:mm:ss"},null,8,["modelValue","onUpdate:modelValue","shortcuts"])):e.view_type==="datenumber"?(p(),b(q,{key:3,class:"border-all",style:{width:"100%",border:"1px solid #dcdfe6"},modelValue:t.queryParam[e.apiName],"onUpdate:modelValue":a=>t.queryParam[e.apiName]=a,type:"daterange",format:"YYYYMMDD","unlink-panels":"","range-separator":"\u81F3","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F",shortcuts:t.shortcuts},null,8,["modelValue","onUpdate:modelValue","shortcuts"])):(p(),b(C,{key:4,class:"border-all",onKeyup:o[0]||(o[0]=fe(a=>t.queryData(1),["enter"])),modelValue:t.queryParam[e.apiName],"onUpdate:modelValue":a=>t.queryParam[e.apiName]=a,placeholder:"\u8BF7\u8F93\u5165\u67E5\u8BE2\u5185\u5BB9"},null,8,["modelValue","onUpdate:modelValue"]))]),_:2},1032,["label"])]),_:2},1024))),256))]),_:1})]),_:1}),r(_,null,{default:n(()=>[r(h,{type:"primary",onClick:o[1]||(o[1]=e=>{t.delAll(),t.queryData(1)})},{default:n(()=>[ve]),_:1}),ke,r(h,{type:"primary",onClick:o[2]||(o[2]=e=>t.addAll())},{default:n(()=>[De]),_:1}),r(h,{type:"primary",onClick:o[3]||(o[3]=e=>t.addAllRow())},{default:n(()=>[Ce]),_:1}),r(h,{type:"primary",onClick:o[4]||(o[4]=e=>t.addOk())},{default:n(()=>[qe]),_:1}),r(h,{type:"warning",onClick:o[5]||(o[5]=e=>t.delAll())},{default:n(()=>[Ee]),_:1})]),_:1})]),_:1}),r(_,null,{default:n(()=>[r(_,{style:{"flex-direction":"column"}},{default:n(()=>[r(_,{style:{border:"1px solid #eee",margin:"10px"}},{default:n(()=>[ee(r(R,{size:"mini",onSortChange:t.handleSortChange,onRowDblclick:t.handleRowDbClick,onLoad:t.handleOnload,data:t.dataGrid.result,height:332,border:""},{default:n(()=>[(p(!0),w(N,null,V(t.tableData.tableInfo.columns,e=>(p(),w(N,null,[e.apiName==="id"?(p(),b(c,{key:0,sortable:e.isSort!=="N"?"custom":!1,"show-overflow-tooltip":!0,"min-width":55,width:"60",prop:e.apiName,label:e.remark},{default:n(a=>[$("a",{href:"javascript:;",onClick:d=>t.openObjectDialog(t.tableData.tableInfo.remark,t.tableData.tableInfo.name,a.row.id)},k(a.row.id),9,Se)]),_:2},1032,["sortable","prop","label"])):e.view_type==="select"?(p(),b(c,{key:1,sortable:e.isSort!=="N"?"custom":!1,prop:e.apiName,"show-overflow-tooltip":!0,"min-width":e.list_size*30+40,label:e.remark,width:"120"},{default:n(a=>[r(B,{size:"mini",style:{color:"white"},color:t.selectColor(a.row[e.apiName],e)},{default:n(()=>[y(k(t.selectLabel(a.row[e.apiName],e)),1)]),_:2},1032,["color"])]),_:2},1032,["sortable","prop","min-width","label"])):e.view_type==="object"?(p(),b(c,{key:2,sortable:e.isSort!=="N"?"custom":!1,prop:e.apiName,"show-overflow-tooltip":!0,"min-width":e.list_size*30+40,label:e.remark},{default:n(a=>[r(G,{class:"el-icon-link",onClick:d=>t.openObjectDialog(e.linkTableName,e.linkTable,a.row[e.apiName])},null,8,["onClick"]),$("span",null,k(a.row[e.apiName+"_desc"]),1)]),_:2},1032,["sortable","prop","min-width","label"])):(p(),b(c,{key:3,sortable:e.isSort!=="N"?"custom":!1,"show-overflow-tooltip":!0,prop:e.apiName,"min-width":e.list_size*30+40,label:e.remark},{default:n(a=>[y(k(a.row[e.apiName]),1)]),_:2},1032,["sortable","prop","min-width","label"]))],64))),256))]),_:1},8,["onSortChange","onRowDblclick","onLoad","data"]),[[l,t.dataGrid.loading]])]),_:1}),r(T,{onSizeChange:o[6]||(o[6]=e=>{t.dataGrid.pageSize=e,t.queryData(t.dataGrid.page)}),onCurrentChange:o[7]||(o[7]=e=>t.queryData(e)),currentPage:t.dataGrid.page,"onUpdate:currentPage":o[8]||(o[8]=e=>t.dataGrid.page=e),onPrevClick:o[9]||(o[9]=e=>t.queryData(t.dataGrid.page-1)),onNextClick:o[10]||(o[10]=e=>t.queryData(t.dataGrid.page+1)),"page-sizes":[10,30,50,100],"page-size":t.dataGrid.pageSize,layout:"sizes,prev,jumper,next,total",total:t.dataGrid.total},null,8,["currentPage","page-size","total"])]),_:1}),r(S,{span:6,style:{padding:"16px","min-width":"248px",overflow:"auto"}},{default:n(()=>[r(U,null,{default:n(()=>[(p(!0),w(N,null,V(t.tags,e=>(p(),b(B,{class:"text_nowrap",type:e.type===1?"warning":"info",style:{margin:"3px"},closable:!0,onClose:a=>t.delTag(e)},{default:n(()=>[y(k(e.tag),1)]),_:2},1032,["type","onClose"]))),256))]),_:1})]),_:1})]),_:1})]),_:1},512),[[l,!1]]),r(Y,{ref:"dialogRef"},null,512)],64)}var Fe=he(ce,[["render",Be],["__scopeId","data-v-b25314d6"]]);export{Fe as default};

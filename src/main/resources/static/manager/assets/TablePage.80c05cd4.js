var e=Object.defineProperty,a=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,o=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,r=(e,r)=>{for(var n in r||(r={}))l.call(r,n)&&o(e,n,r[n]);if(a)for(var n of a(r))t.call(r,n)&&o(e,n,r[n]);return e};"undefined"!=typeof require&&require;import{s as n,b as i,y as s,v as d,x as u,u as p,a as m,e as c,r as g,f as b,i as f,c as y,H as h,w as D,g as w,h as N,F as k,o as _,j as v,l as q,k as C,C as x,t as I}from"./vendor.70422edf.js";import{d as P,a as S,s as j,b as O}from"./index.f1b42049.js";import{e as V,g as z,_ as Y}from"./CustomDialog.5ebe0272.js";import M from"./SearchPage.373e9309.js";import T from"./JobPage.c96c375c.js";import G from"./ObjectPage.a9e4bb42.js";var U=c({props:{},setup:(e,a)=>r({},function(){let e=n({}),a=n({loading:!1,tableInfo:{}}),l=n({loading:!1,result:[],page:1,pageSize:30,orders:[],total:0,totalPage:0,selection:[]}),t=t=>{let o={};a.tableInfo.columns.forEach((a=>{let l=e[a.apiName];l&&("datenumber"==a.view_type?l.length>0&&(o[a.apiName]="BETWEEN "+P(l[0])+" AND "+P(l[1])):"date"==a.view_type?l.length>0&&(o[a.apiName]=[S(l[0]),S(l[1])]):"object"==a.view_type?l.length>0&&(o[a.apiName]=e[a.apiName]):o[a.apiName]=e[a.apiName])})),l.loading=!0,i.post("/sys/manager/api/"+a.tableInfo.name+"/list",{where:o,page:t,pageSize:l.pageSize,orders:l.orders}).then((e=>{l.result=e.data.datas,l.total=e.data.total,l.page=e.data.page,l.pageSize=e.data.pageSize,l.totalPage=e.data.totalPage,l.loading=!1})).catch((e=>{j(e),l.loading=!1}))},o=z();(()=>{const o=p();a.loading=!0,i.get("/sys/manager/api/table?name="+o.params.tableName).then((o=>{var r;a.tableInfo=o.data;try{l.orders=JSON.parse(null!=(r=a.tableInfo.defOrders)?r:"[]")}catch(n){j(n),console.log(n)}a.tableInfo.columns.forEach((a=>{if("datenumber"===a.view_type&&a.queryDefault){var l=parseInt(a.queryDefault)||7;const t=new Date;t.setTime(t.getTime()-864e5*l),e[a.apiName]=[new Date(t.getFullYear(),t.getMonth(),t.getDate()),new Date(t.getFullYear(),t.getMonth(),t.getDate(),24)]}else if("date"===a.view_type&&a.queryDefault){l=parseInt(a.queryDefault)||1;const t=new Date;t.setTime(t.getTime()-864e5*l),e[a.apiName]=[new Date(t.getFullYear(),t.getMonth(),t.getDate()),new Date(t.getFullYear(),t.getMonth(),t.getDate(),24)]}else"select"===a.view_type&&a.queryDefault||"check"===a.view_type&&a.queryDefault?e[a.apiName]=a.queryDefault:e[a.apiName]=""})),a.loading=!1,a.tableInfo.url||t(1)})).catch((e=>{j(e),a.loading=!1}))})();let c=d((()=>{var e,l;return null==(l=null==(e=a.tableInfo)?void 0:e.columns)?void 0:l.filter((e=>"Y"===e.isQuery&&"N"!==e.isListCol))})),g=d((()=>{var e,l;return null==(l=null==(e=a.tableInfo)?void 0:e.columns)?void 0:l.filter((e=>"N"!==e.isListCol))}));m();let b=d((()=>O()));return u(a,(a=>{a.tableInfo.columns.forEach((a=>{if("datenumber"===a.view_type&&a.queryDefault){const t=new Date;var l=parseInt(a.queryDefault)||7;t.setTime(t.getTime()-864e5*l),e[a.apiName]=[new Date(t.getFullYear(),t.getMonth(),t.getDate()),new Date(t.getFullYear(),t.getMonth(),t.getDate(),24)]}else if("date"===a.view_type&&a.queryDefault){const t=new Date;l=parseInt(a.queryDefault)||1,t.setTime(t.getTime()-864e5*l),e[a.apiName]=[new Date(t.getFullYear(),t.getMonth(),t.getDate()),new Date(t.getFullYear(),t.getMonth(),t.getDate(),24)]}else"select"===a.view_type&&a.queryDefault||"check"===a.view_type&&a.queryDefault?e[a.apiName]=a.queryDefault:e[a.apiName]=""}))})),r({tableData:a,shortcuts:b,queryParam:e,queryCols:c,queryData:t,listCols:g,selectLabel:(e,a)=>{let l=a.selectOps.filter((a=>a.name==e));return l.length>0?l[0].remark:""},selectColor:(e,a)=>{let l=a.selectOps.filter((a=>a.name==e));return l.length>0?l[0].color:""},dataGrid:l,handleSortChange:(e,a,o)=>{l.orders=e.prop?[{field:e.prop,order:"ascending"==e.order?"asc":"desc"}]:[],t(l.page)},handleSelectionChange:e=>{l.selection=s(e)},handleRowDbClick:(e,l,t)=>{o.openObjectDialog(a.tableInfo.remark,a.tableInfo.name,e.id)},findMutiObject:a=>{let l=o.openDialog("查询-"+a.remark,M,{tableName:a.linkTable},{closeDialog:function(t){e[a.apiName]=JSON.stringify(t),e[a.apiName+"_desc"]=t.desc,l.close()}})},execBtn:V},o)}()),name:"TablePage",components:{CustomDialog:Y,JobPage:T,ObjectPage:G}});const F=["src"],E=["onClick"],J=q("查询"),R=C("span",{style:{flex:"1"}},null,-1),L=C("span",{style:{flex:"1"}},null,-1);U.render=function(e,a,l,t,o,r){const n=g("el-option"),i=g("el-select"),s=g("el-input"),d=g("el-date-picker"),u=g("el-form-item"),p=g("el-col"),m=g("el-row"),c=g("el-form"),P=g("el-container"),S=g("el-button"),j=g("el-card"),O=g("el-pagination"),V=g("el-table-column"),z=g("el-tag"),Y=g("el-icon"),M=g("el-table"),T=g("custom-dialog"),G=b("loading");return _(),f(k,null,[null!=e.tableData.tableInfo.name&&null!=e.tableData.tableInfo.url&&e.tableData.tableInfo.url.length>0&&e.tableData.tableInfo.url.indexOf("/")>=0?(_(),f("iframe",{key:0,style:{width:"100%",height:"calc(100% - 10px)",border:"none"},src:e.tableData.tableInfo.url},null,8,F)):null!=e.tableData.tableInfo.name&&null!=e.tableData.tableInfo.url&&e.tableData.tableInfo.url.length>0?(_(),y(h(e.tableData.tableInfo.url),{key:1})):D((_(),y(P,{key:2,style:{"flex-direction":"column"},"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading"},{default:w((()=>[N(j,{shadow:"always",style:{margin:"10px"}},{default:w((()=>[N(P,{style:{"flex-direction":"row","padding-top":"6px"}},{default:w((()=>[N(c,{class:"custom-form",size:"mini","label-width":"80px"},{default:w((()=>[N(m,{gutter:0,style:{width:"100%"}},{default:w((()=>[(_(!0),f(k,null,v(e.queryCols,(l=>(_(),y(p,{xs:24,sm:e.queryCols.length<=1?24:12,md:e.queryCols.length<=3?12:6},{default:w((()=>[N(u,{label:l.remark},{default:w((()=>["select"===l.view_type?(_(),y(i,{key:0,class:"border-all",modelValue:e.queryParam[l.apiName],"onUpdate:modelValue":a=>e.queryParam[l.apiName]=a,placeholder:"请选择"},{default:w((()=>[N(n,{label:"全部",value:""}),(_(!0),f(k,null,v(l.selectOps,(e=>(_(),y(n,{label:e.remark,value:e.name},null,8,["label","value"])))),256))])),_:2},1032,["modelValue","onUpdate:modelValue"])):"object"===l.view_type?(_(),y(s,{key:1,class:"border-all",modelValue:e.queryParam[l.apiName+"_desc"],"onUpdate:modelValue":a=>e.queryParam[l.apiName+"_desc"]=a,placeholder:"请输入内容"},{suffix:w((()=>[C("i",{class:"el-icon-search",onClick:a=>e.findMutiObject(l,!0),style:{padding:"3px"}},null,8,E)])),_:2},1032,["modelValue","onUpdate:modelValue"])):"date"===l.view_type?(_(),y(d,{key:2,class:"border-all",style:{border:"1px solid #dcdfe6",width:"100%"},modelValue:e.queryParam[l.apiName],"onUpdate:modelValue":a=>e.queryParam[l.apiName]=a,type:"datetimerange","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",shortcuts:e.shortcuts,format:"YYYYMMDD HH:mm:ss"},null,8,["modelValue","onUpdate:modelValue","shortcuts"])):"datenumber"===l.view_type?(_(),y(d,{key:3,class:"border-all",style:{border:"1px solid #dcdfe6",width:"100%"},modelValue:e.queryParam[l.apiName],"onUpdate:modelValue":a=>e.queryParam[l.apiName]=a,type:"daterange",format:"YYYYMMDD","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",shortcuts:e.shortcuts},null,8,["modelValue","onUpdate:modelValue","shortcuts"])):(_(),y(s,{key:4,class:"border-all",onKeyup:a[0]||(a[0]=x((a=>e.queryData(1)),["enter"])),modelValue:e.queryParam[l.apiName],"onUpdate:modelValue":a=>e.queryParam[l.apiName]=a,placeholder:"请输入查询内容"},null,8,["modelValue","onUpdate:modelValue"]))])),_:2},1032,["label"])])),_:2},1032,["sm","md"])))),256))])),_:1})])),_:1})])),_:1}),N(P,{style:{height:"28px",border:"none",padding:"0px"}},{default:w((()=>[N(S,{type:"primary",onClick:a[1]||(a[1]=a=>e.queryData(1))},{default:w((()=>[J])),_:1}),R])),_:1})])),_:1}),N(P,{style:{border:"1px solid #eee",margin:"10px","flex-direction":"column"}},{default:w((()=>[N(P,{style:{height:"36px",border:"none",padding:"4px"}},{default:w((()=>[N(O,{class:"border-none",onSizeChange:a[2]||(a[2]=a=>{e.dataGrid.pageSize=a,e.queryData(e.dataGrid.page)}),onCurrentChange:a[3]||(a[3]=a=>e.queryData(a)),currentPage:e.dataGrid.page,"onUpdate:currentPage":a[4]||(a[4]=a=>e.dataGrid.page=a),onPrevClick:a[5]||(a[5]=a=>e.queryData(e.dataGrid.page-1)),onNextClick:a[6]||(a[6]=a=>e.queryData(e.dataGrid.page+1)),"page-sizes":[10,30,50,100],"page-size":e.dataGrid.pageSize,layout:"sizes, prev, pager, next,total",total:e.dataGrid.total},null,8,["currentPage","page-size","total"]),L,(_(!0),f(k,null,v(e.tableData.tableInfo.buttons,(a=>(_(),y(S,{type:"primary",id:a.name,"data-btninfo":JSON.stringify(a),onClick:l=>e.execBtn(a,e.dataGrid.selection,(()=>{e.queryData(1)}))},{default:w((()=>[q(I(a.remark),1)])),_:2},1032,["id","data-btninfo","onClick"])))),256))])),_:1}),D(N(M,{size:"mini",onSortChange:e.handleSortChange,onSelectionChange:e.handleSelectionChange,onRowDblclick:e.handleRowDbClick,data:e.dataGrid.result,height:480,border:""},{default:w((()=>[N(V,{type:"selection",width:"55"}),(_(!0),f(k,null,v(e.listCols,(a=>(_(),f(k,null,["id"===a.apiName?(_(),y(V,{key:0,sortable:"N"!==a.isSort,"show-overflow-tooltip":!0,width:"60",prop:a.apiName,label:a.remark},null,8,["sortable","prop","label"])):"select"===a.view_type?(_(),y(V,{key:1,sortable:"N"!==a.isSort,"show-overflow-tooltip":!0,prop:a.apiName,label:a.remark,width:"120"},{default:w((l=>[N(z,{size:"mini",style:{color:"white"},color:e.selectColor(l.row[a.apiName],a)},{default:w((()=>[q(I(e.selectLabel(l.row[a.apiName],a)),1)])),_:2},1032,["color"])])),_:2},1032,["sortable","prop","label"])):"object"===a.view_type?(_(),y(V,{key:2,sortable:"N"!==a.isSort,"show-overflow-tooltip":!0,"min-width":30*a.list_size+40,prop:a.apiName,label:a.remark},{default:w((l=>[N(Y,{class:"el-icon-link",onClick:t=>e.openObjectDialog(a.linkTableName,a.linkTable,l.row[a.apiName])},null,8,["onClick"]),C("span",null,I(l.row[a.apiName+"_desc"]),1)])),_:2},1032,["sortable","min-width","prop","label"])):(_(),y(V,{key:3,sortable:"N"!==a.isSort,"show-overflow-tooltip":!0,prop:a.apiName,"min-width":30*a.list_size+40,label:a.remark},{default:w((e=>[q(I(e.row[a.apiName]),1)])),_:2},1032,["sortable","prop","min-width","label"]))],64)))),256))])),_:1},8,["onSortChange","onSelectionChange","onRowDblclick","data"]),[[G,e.dataGrid.loading]])])),_:1})])),_:1},512)),[[G,e.tableData.loading]]),N(T,{ref:"dialogRef"},null,512)],64)};export default U;
